#!/bin/bash
set -euo pipefail

ICON_DIR="$HOME/.local/share/applications/icons"
DESKTOP_DIR="$HOME/.local/share/applications"

if [[ "$#" -ne 1 ]]; then
  # Find all Chromium app desktop entries
  mapfile -t WEB_APPS < <(find "$DESKTOP_DIR" -name '*.desktop' -print0 \
    | xargs -0 -I{} sh -c 'grep -q "^Exec=.*chromium.*--app" "{}" && basename "{}" .desktop' \
    | sort)

  if ((${#WEB_APPS[@]})); then
    APP_NAME="$(printf "%s\n" "${WEB_APPS[@]}" | gum choose --limit 1)"
  fi
else
  APP_NAME="$1"
fi

if [[ -z "${APP_NAME:-}" ]]; then
  echo "You must provide web app name."
  exit 1
fi

rm -f "$DESKTOP_DIR/$APP_NAME.desktop" "$ICON_DIR/$APP_NAME.png"

if [[ "$#" -ne 1 ]]; then
  echo -e "Removed $APP_NAME\n"
fi
